<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Credential Issuer</title>

  <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='./img/3D.ico') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='wallet-chooser.css') }}">
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="container header__inner">
      <a class="brand" href="https://altme.io/">
        <img class="brand__logo" src="/static/img/Talao + Altme wallets logo.png" alt="Altme Logo" />
      </a>
<!--
      <nav class="header__actions">
        <a class="btn btn--ghost" href="https://altme.io/">Back to home</a>
        <a class="btn btn--primary" href="mailto:contact@altme.io?cc=hugo@altme.io&subject=Altme">Contact</a>
      </nav> -->
    </div>
  </header>

  <!-- Main -->
  <main class="main">
    <div class="container">

      <!-- Desktop QR -->
      <section class="qr desktop-only" aria-label="QR code section">
        <div class="card">
          <div class="card__header">
            <h1 class="title">Your ID has been verified!</h1>
            <p class="subtitle">Scan the QR code with Altme or Talao to get your credential.</p>
          </div>

          <div class="qr__box" role="img" aria-label="QR code">
            <img class="qr__img" id="qrcodeIssuer" src="{{ qrcode(url) }}" alt="QR Code to retrieve credential" />
          </div>

          <div class="hint">
            On mobile, you can open your wallet directly below.
          </div>
        </div>
      </section>

      <!-- Mobile wallet buttons -->
      <section class="wallet mobile-only" aria-label="Wallet selection">
        <div class="card card--compact">
          <div class="card__header">
            <h1 class="title">Your ID has been verified!</h1>
            <p class="subtitle">Get your credential in your wallet.</p>
          </div>

          <div class="wallet__grid">
            <a class="wallet__item" href="{{deeplink_altme}}">
              <img class="wallet__icon wallet__icon--wide" src="/static/img/AltMe.png" alt="Altme wallet" />
              <div class="wallet__text">
                <div class="wallet__name">Altme</div>
                <div class="wallet__desc">Identity, data and crypto</div>
              </div>
              <span class="wallet__chev" aria-hidden="true">›</span>
            </a>

            <a class="wallet__item" href="{{deeplink_talao}}">
              <img class="wallet__icon wallet__icon--wide" src="/static/img/talao_icon.png" alt="Talao wallet" />
              <div class="wallet__text">
                <div class="wallet__name">Talao</div>
                <div class="wallet__desc">Identity and data</div>
              </div>
              <span class="wallet__chev" aria-hidden="true">›</span>
            </a>
          </div>

          <p class="privacy">
            By continuing, you’ll be redirected to your wallet to approve the issuance request.
          </p>
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container footer__inner">
      <p class="footer__text">
        &copy; 2026 Web3 Digital Wallet — All rights reserved.
        <a href="https://altme.io/cgu/" target="_blank" rel="noopener">CGU</a>,
        <a href="https://altme.io/privacy/" target="_blank" rel="noopener">Privacy</a>
      </p>

      <div class="footer__social">
        <a href="https://twitter.com/Altme_io" target="_blank" rel="noopener" aria-label="Twitter">
          <img src="https://dvzvtsvyecfyp.cloudfront.net/static/img/icons/social/black/twitter.svg" alt="" width="22" height="22" />
        </a>
        <a href="https://www.linkedin.com/company/altme-web3/" target="_blank" rel="noopener" aria-label="LinkedIn">
          <img src="https://dvzvtsvyecfyp.cloudfront.net/static/img/icons/social/black/linkedin.svg" alt="" width="22" height="22" />
        </a>
      </div>
    </div>
  </footer>

  <!-- Script (preserved exactly) -->
  <script>
    var source = new EventSource('/sandbox/ebsi/issuer_stream');
    source.onmessage = function (event) {
      const data = JSON.parse(event.data);
      if (data.stream_id === '{{stream_id}}') {
        const url = data.error
          ? '/sandbox/ebsi/issuer_followup/{{stream_id}}?error=' + data.error + '&error_description=' + data.error_description
          : '/sandbox/ebsi/issuer_followup/{{stream_id}}';
        window.location.href = url;
      }
    };
  </script>
</body>
</html>
